<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>NCL Gym Exploitation ‘Python 2’ | Hi</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="NCL Gym Exploitation ‘Python 2’" />
<meta name="author" content="Zack Jones" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="So this challenge at first glance was intimidating. There was a bit more going on in this one. But always, always, always - code looks scarier than it actually is. But before we get into the code. The download was a .pyc file." />
<meta property="og:description" content="So this challenge at first glance was intimidating. There was a bit more going on in this one. But always, always, always - code looks scarier than it actually is. But before we get into the code. The download was a .pyc file." />
<link rel="canonical" href="http://localhost:4000/infosec/2018/04/02/NCL-Gym-Exploitation-PYTHON2.html" />
<meta property="og:url" content="http://localhost:4000/infosec/2018/04/02/NCL-Gym-Exploitation-PYTHON2.html" />
<meta property="og:site_name" content="Hi" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-04-02T21:13:00-04:00" />
<script type="application/ld+json">
{"datePublished":"2018-04-02T21:13:00-04:00","@type":"BlogPosting","description":"So this challenge at first glance was intimidating. There was a bit more going on in this one. But always, always, always - code looks scarier than it actually is. But before we get into the code. The download was a .pyc file.","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/infosec/2018/04/02/NCL-Gym-Exploitation-PYTHON2.html"},"url":"http://localhost:4000/infosec/2018/04/02/NCL-Gym-Exploitation-PYTHON2.html","author":{"@type":"Person","name":"Zack Jones"},"headline":"NCL Gym Exploitation ‘Python 2’","dateModified":"2018-04-02T21:13:00-04:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Hi" /></head>

  <!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106768649-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-106768649-1');
</script>



  <body>

    <header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Hi</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/feed/">Feed</a><a class="page-link" href="/Blog/">Blog</a><a class="page-link" href="/Cisco/">Cisco</a><a class="page-link" href="/InfoSec/">InfoSec</a><a class="page-link" href="/Linux/">Linux</a><a class="page-link" href="/networking/">Networking</a><a class="page-link" href="/Server/">Server</a></div>
      </nav></div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">NCL Gym Exploitation &#39;Python 2&#39;</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-04-02T21:13:00-04:00" itemprop="datePublished">Apr 2, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>So this challenge at first glance was intimidating. There was a bit more going on in this one. But always, always, always - code looks scarier than it actually is. But before we get into the code. The download was a .pyc file.</p>

<p>Wut.</p>

<p>I’ve made a few python scripts before and I’ve never seen pyc. Google time.</p>

<p>Oh. Well. This is usually where I stop. I usually skip compiled stuff, and a pyc is a compiled python program.</p>

<p>Luckily there are tools to undo the ugly compiled mess. I’m on a Mac so I used brew to install uncompyle6. Again I googled for a bit.</p>

<p>uncompyle6 is simple. Put in a pyc and out comes code.</p>

<p>This is what my terminal spits out</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ uncompyle6 PYTHON2.pyc
# uncompyle6 version 3.1.1
# Python bytecode 2.7 (62211)
# Decompiled from: Python 2.7.10 (default, Jul 15 2017, 17:16:57)
# [GCC 4.2.1 Compatible Apple LLVM 9.0.0 (clang-900.0.31)]
# Embedded file name: NCL-2015-Python2.py
# Compiled at: 2015-11-12 17:43:01
import sys

def main():
    if len(sys.argv) != 2:
        print 'Invalid args'
        return
    password = sys.argv[1]
    counter = 0
    vals = list('tfzbwlyzljylawhzzdvyk')
    if len(password) != len(vals):
        print 'incorrect'
        return
    while counter &lt; len(password):
        x = ord(password[counter]) + 7
        if x &gt; ord('z'):
            x -= 26
        if chr(x) != vals[counter]:
            print 'incorrect'
            return
        counter += 1

    print 'correct'


if __name__ == '__main__':
    main()
# okay decompiling PYTHON2.pyc
</code></pre></div></div>

<p>Ugh. I should have put that into a file or something. Run it again but do it better!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ uncompyle6 PYTHON2.pyc &gt; thisisthecode.py
</code></pre></div></div>

<p>Head over to sublime text and browse on over to find this beautiful python code that I can actually work with.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">'Invalid args'</span>
        <span class="k">return</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s">'tfzbwlyzljylawhzzdvyk'</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">'incorrect'</span>
        <span class="k">return</span>
    <span class="k">while</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">password</span><span class="p">[</span><span class="n">counter</span><span class="p">])</span> <span class="o">+</span> <span class="mi">7</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="nb">ord</span><span class="p">(</span><span class="s">'z'</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">-=</span> <span class="mi">26</span>
        <span class="k">if</span> <span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">vals</span><span class="p">[</span><span class="n">counter</span><span class="p">]:</span>
            <span class="k">print</span> <span class="s">'incorrect'</span>
            <span class="k">return</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">print</span> <span class="s">'correct'</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p>Okay okay. Let’s try to figure this sucker out. Diving in section by section.</p>

<pre><code class="language-pyhton">vals = list('tfzbwlyzljylawhzzdvyk')
</code></pre>
<p>turns tfzbwlyzljylawhzzdvyk into a list of each letter. so vals[2], the third item in the vals list is z. For example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
</code></pre></div></div>
<p>if your password isn’t the length of the vals list then no go.</p>

<p>Checking the length of val</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>len('tfzbwlyzljylawhzzdvyk')
&gt;&gt;&gt;21
</code></pre></div></div>
<p>So the password is 21 characters.</p>

<p>If you’ve got that far then it runs a while loop.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
</code></pre></div></div>
<p>Starting at the first position, do stuff until we get to the end. Okay simple. So far we are just setting up the parameters of the length of the password and telling the code to check each character until we get to the end. Nothing really important yet.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">password</span><span class="p">[</span><span class="n">counter</span><span class="p">])</span> <span class="o">+</span> <span class="mi">7</span>
</code></pre></div></div>
<p>This is interesting. It looks at the current letter and makes the ord and adds 7 to it. And then sets it to a variable called X. So basically, make the letters into numbers and move them up 7.</p>
<blockquote>
  <p>this is where you can imagine and assume that this letters to numbers thing is going to at some point be undone. Go ahead and imagine that. Good. Got it? For example, a password of ‘aaa’ would ord into something like ‘111’ and then we add 7 to make it ‘888’ and then back to letters ‘hhh’. Hmm. Whatever that’s weird.</p>
</blockquote>

<p>Moving on.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="nb">ord</span><span class="p">(</span><span class="s">'z'</span><span class="p">):</span>
	<span class="n">x</span> <span class="o">-=</span> <span class="mi">26</span>
</code></pre></div></div>
<p>Basically if we get to z, go back to a. <br />
This is here so that after the letter z we loop back to a.</p>

<p>This next part is the part that matters most.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">vals</span><span class="p">[</span><span class="n">counter</span><span class="p">]:</span>
</code></pre></div></div>

<p>So far we have done a lot with shifting things back and forth. So at first glance, this looks confusing, but it basically says, letter for letter, our manipulated password (the plus 7 ord stuff) needs to equal the string in val. Or at least that is what it looks like.</p>

<p>Of course I wrote a test code. I commented some things in the code, but most importantly, before the last if, and before the if statement that loops things back, I print both the vals[counter] and the chr(x)</p>

<p>I then comment out the last if completely so it doesn’t stop running.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">'Invalid args'</span>
        <span class="k">return</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1">#counts the length                         
</span>    <span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s">'tfzbwlyzljylawhzzdvyk'</span><span class="p">)</span> <span class="c1">#list() converts a string into a list made up of the letters
</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span> <span class="c1">#password must be 21 characters
</span>        <span class="k">print</span> <span class="s">'length of the password must be 21 letters'</span>
        <span class="k">return</span>
    <span class="k">while</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">):</span> <span class="c1">#moving through the letters
</span>        <span class="n">x</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">password</span><span class="p">[</span><span class="n">counter</span><span class="p">])</span> <span class="o">+</span> <span class="mi">7</span> <span class="c1">#add 7 to the ord of the letter
</span>        <span class="c1"># this is our test code here
</span>        <span class="k">print</span> <span class="n">vals</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span>
        <span class="k">print</span> <span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1">#Back to normal code
</span>        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="nb">ord</span><span class="p">(</span><span class="s">'z'</span><span class="p">):</span> <span class="c1"># when the ord hits lowercase z, move x back
</span>            <span class="n">x</span> <span class="o">-=</span> <span class="mi">26</span>
        <span class="c1">#if chr(x) != vals[counter]: #if the current letter does not equal the counter
</span>           <span class="c1"># print 'counter has to equal the thing'
</span>
           <span class="c1"># return
</span>        
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>

</code></pre></div></div>

<p>Then I run it.</p>

<p><code>
$ python PYTHON2-test.py aaaaaaaaaaaaaaaaaaaaa
t
h
f
h
z
h
b
h
w
h
l
h
y
h
z
h
l
h
j
h
y
h
l
h
a
h
w
h
h
h
z
h
z
h
d
h
v
h
y
h
k
h
</code></p>

<p>so. Remember it’s doing a single character print of the vals[counter] then chr(x) and repeating. so every odd character is vals[counter] and every even is chr(x). So split it up and line them side by side and see what we get.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>t h
f h
z h
b h
w h
l h
y h
z h
l h
j h
y h
l h
a h
w h
h h
z h
z h
d h
v h
y h
k h
</code></pre></div></div>

<p>Weirdddd. It worked just like we thought it maybe would. And remember we are printed these two lines of letters because they have to match.</p>

<p>Weeelllll.</p>

<p>Then maybe we can flip the code?</p>
<blockquote>
  <p>I know we could do this with pencil and paper but why not try to use this code that is already in front of us?</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">password</span><span class="p">[</span><span class="n">counter</span><span class="p">])</span> <span class="o">+</span> <span class="mi">7</span>
</code></pre></div></div>
<p>change it to</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">password</span><span class="p">[</span><span class="n">counter</span><span class="p">])</span> <span class="o">-</span> <span class="mi">7</span>
</code></pre></div></div>

<p>and of course we have to flip</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="nb">ord</span><span class="p">(</span><span class="s">'z'</span><span class="p">):</span> 
            <span class="n">x</span> <span class="o">-=</span> <span class="mi">26</span>
</code></pre></div></div>
<p>to</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="nb">ord</span><span class="p">(</span><span class="s">'a'</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="mi">26</span>
</code></pre></div></div>

<p>Remember, this is there so that if the counter goes past z, make it start back at a.</p>

<p>so the oppsite would be: if it subtracts below a, push it back up to z.
And while we are here let’s delete the code we put in the print their string. No need.</p>

<p>Now let’s put in their string as the input and see what comes out.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>m
_
s
[
p
e
r
s
e
c
r
e
Z
p
a
s
s
]
o
r
d
</code></pre></div></div>
<p>Eh. it’s not quite looping back the way we want it to. <br />
But wait. let’s look at it for a second. <br />
<code>m_s[persecreZpass]ord</code><br />
So. Maybe I’m not the best with Python and I messed something up   somewhere. But. It’s clear that the password is something in like likes of:<br />
 <code>mysupersecretpassword</code></p>

<p>Let’s try it.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python PYTHON2.py mysupersecretpassword
correct
</code></pre></div></div>

<p>lolll.</p>

<p>Okay done.</p>

<p>-Cheers</p>

<p>Zack.</p>


  </div><a class="u-url" href="/infosec/2018/04/02/NCL-Gym-Exploitation-PYTHON2.html" hidden></a>
</article>

      </div>
    </main>

    <footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Hi</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Zack Jones</li><li><a class="u-email" href="mailto:hi.imzackjones@gmail.com">hi.imzackjones@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/hiimzackjones"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">hiimzackjones</span></a></li><li><a href="https://www.twitter.com/mehhsecurity"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">mehhsecurity</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A very Mehh Networking and Cybersecurity online notebook and blog.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
