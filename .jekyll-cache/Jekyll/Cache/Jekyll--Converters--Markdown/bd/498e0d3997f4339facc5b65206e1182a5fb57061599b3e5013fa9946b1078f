I"®<p><img src="/assets/img/Walkthroughs/Blue/Blue.png" alt="blue" /></p>

<p>Hi Hello again. This box is going to be a quick one but a really important one to knock out if you‚Äôre looking to learn for the OSCP. You can probably guess what vulnerability we are going to be poking at with this one, but I won‚Äôt spoil early. :)</p>

<h2 id="enumeration">Enumeration</h2>

<p>Usually I post about both nmap and nmapautomator but this round we are going to try a new tool that I‚Äôve heard loads of good things about. This tool has just a massive amount of stuff it does for you and organizes the outputs for you in a file structure that is nifty so. Let‚Äôs try that out.</p>

<h2 id="autorecon">AutoRecon</h2>

<p><img src="/assets/img/Walkthroughs/Blue/AutoReconScreenshot.png" alt="AutoReconScreen" /></p>

<p>First, let‚Äôs get an understanding of how this bad boy works. Head over to it‚Äôs github at <a href=""></a> and <a href="https://github.com/Tib3rius/AutoRecon/blob/master/README.md">look at the source.</a> Or not‚Ä¶ I‚Äôm going to quickly tell you either way.</p>

<p>Now before you go download it and start using it on pentesting engagements, please know that <strong>it can be noisey</strong>. It has been designed for CTFs and OSCP like certification stuff.</p>

<p>Also, it‚Äôs basically a script that runs other tools that you most likely would want to run anyway. Here is the list:</p>

<ul>
  <li>curl</li>
  <li>enum4linux</li>
  <li>gobuster</li>
  <li>nbtscan</li>
  <li>nikto</li>
  <li>nmap</li>
  <li>onesixtyone</li>
  <li>oscanner</li>
  <li>smbclient</li>
  <li>smbmap</li>
  <li>smtp-user-enum</li>
  <li>snmpwalk</li>
  <li>sslscan</li>
  <li>svwar</li>
  <li>tnscmd10g</li>
  <li>whatweb</li>
  <li>wkhtmltoimage</li>
</ul>

<p>You can imagine how this works. It runs a handful of nmap scans, and based off of what it sees in the scans, it starts using other tools as needed to continue the enumeration. So for example, it sees that port 80 or 443 is open. Then it might run something like dirbuster and nikto against it automatically. This sort of handles the repetitive steps that you do for every machine anyway and gets you right into investigating how to get in, or maybe where to look for further enumeration.</p>

<p>Now, because it does so much, you can imagine how much data there is to look through. Here is a quick look at the files I got from running it against Blue.</p>

<p><img src="/assets/img/Walkthroughs/Blue/AutoReconFiles.png" alt="AutoRecon" /></p>

<p>In there you‚Äôve got a list of the commands it ran to get the results, the results of a basic nmap scan, smbclient, enum4linux, etc.</p>
<blockquote>
  <p>Note: Notice it sets up structure for the rest of your pentest. You have directories to place other notes moving forward. Pretty freaking cool stuff.</p>
</blockquote>

<p>So this is what we got to work with for breaking into this bad boy.</p>

<h2 id="nmap">Nmap</h2>
<p>This output is from an nmap scan that goes something like this:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap -VV --reason -Pn -A --osscan-guess --version-all -p- 10.10.10.40
</code></pre></div></div>
<p><img src="/assets/img/Walkthroughs/Blue/FullTCPNmapAR.png" alt="AR Nmap" /></p>

<p>This is the second half to that.</p>

<p><img src="/assets/img/Walkthroughs/Blue/FullTCPNmapAR2.png" alt="AR Nmap" /></p>

<p>So what we know is:</p>
<ul>
  <li>Windows 7 Professional 7601 Service Pack 1</li>
  <li>Name - haris-PC</li>
  <li>SMB message signing default message signing disabled <em>woooo!</em></li>
  <li>Ports 139 and 445 <em>oh buddy this looks like smb again</em></li>
</ul>

<h2 id="smb">SMB</h2>

<p>This was some output for the SMBMap it ran. If we didn‚Äôt know it was Windows, we sure as heck do now. Lol. Look at all those files we get to see. Kind of silly tbh.<br />
<img src="/assets/img/Walkthroughs/Blue/SMBMap.png" alt="" /></p>

<p>The SMBClient seems way less fruitful after seeing the SMBMap results. But here they are.</p>

<p><img src="/assets/img/Walkthroughs/Blue/SMBClient.png" alt="" /></p>

<p>From this we can tell that:</p>
<ul>
  <li>SMB is wide open it seems.</li>
  <li>Big confirm on Windows 7 based off of the files we see in the SMB</li>
</ul>

<h2 id="everything-else">Everything else</h2>

<p>There was plenty more but this is the stuff that matters so far. If you‚Äôre really curious <a href="/assets/img/Walkthroughs/Blue/AutoRecon/10.10.10.40">Here is the complete set of files I got from the AutoRecon</a></p>

<h2 id="nmapautomator">nmapAutomator</h2>
<p>Okayyyy okayy. Calm down. I know I lied. But It‚Äôs important to know what you get with each type of automatic scan and what you don‚Äôt. And what I didn‚Äôt see in AutoRecon was a list of CVEs. I had ran nmapAutomator when breaking into this machine and just happen to have the results saved. So let‚Äôs take a look at what we got from the nmapAutomator.</p>

<p>Almost everything was the same, but I noticed this little tasty note in the nmap vuln scan.</p>

<p><img src="/assets/img/Walkthrough/Blue/nmapAutomatorSMBVuln.png" alt="SMB Vuln" /></p>

<p>The takeaway from that screenshot is:</p>
<ul>
  <li>SMB MS17-010 Vulnerable</li>
  <li>CVE-2017-0143 is the CVE for it.</li>
  <li>Resource section url says ‚Äúwannacrypt attack‚Äù in the url. <em>freakingg bet</em></li>
</ul>

<h2 id="investigating-cves">Investigating CVEs</h2>

<p>Now we absolutely have enough information to start firing off some hacker magic EternalBlue pew pew. But before we do. Let‚Äôs back up. Let‚Äôs imagine all you did was a simple nmap and you know it has SMB and it‚Äôs Windows 7.</p>
<blockquote>
  <p>The first time I broke into this box I didn‚Äôt have nmapAutomator or any other special fancy stuff and all I knew was SMB Windows 7 Pro. So let‚Äôs just time travel back to that guy.</p>
</blockquote>

<p>A simple google search can help on this. I‚Äôm taking time to write this part out because you‚Äôre going to run into machines that lack information. Not every vulnerability or CVE is just gonna happily annouce itself. Learn to take small chunks of what you know to dig further. So‚Ä¶.</p>

<p><img src="/assets/img/Walkthroughs/Blue/WindowsSearch.png" alt="Windows 7 Google" /></p>

<p>You already see the first hit is for MS17-010. You also see a Priv Esc for CVE-2019-1132 that would maybe work on this machine as well. The third link is another exploit for EternalBlue. At this point you have enough information to know where to start. Without those big scans, you still have the ability to figure this out. What would the next step be? <strong>Read about the exploits</strong> not <strong>fire lasers</strong>. Make sure the exploit makes sense for what you‚Äôre using. Doing some reading you‚Äôll find that‚Ä¶</p>

<ul>
  <li>EternalBlue does remote code execution.</li>
  <li>valid for machines running SMBv1</li>
  <li>Works for Windows Vista, Windows 7, and Windows Server 2008 (most versions of these)</li>
  <li>Also works on Windows 8, 10, Server 2012 and 2016 if left not updated. But mainly the previously mentioned due to Windows not updating those machines anymore.</li>
  <li>It has many CVEs. Basically CVE-2017-0143 to CVE-2017-0148</li>
</ul>

<p>And with that, your brain should go <em>Are we Windows 7‚Ä¶yep‚Ä¶Are we SMBv1‚Ä¶.yep</em> and now is when you start to figure out how to fire it off. Head over to Metasploit.</p>

<h2 id="firing-the-lasers-exploitation">Firing the lasers (Exploitation)</h2>

<p>Okay. I‚Äôm only going to show the Metasploit exploit for this for now. I might add the manual later. You guys remember how this goes?</p>

<p><img src="" alt="Searchsploit" />
<img src="" alt="SearchingMetasploit" />
<img src="" alt="SettingOptions" />
<img src="" alt="Firing away" />
<img src="" alt="LookingAround" /></p>
:ET